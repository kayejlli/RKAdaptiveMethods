MODULE rk1412FeaginMod

USE GlobalCommonMod
USE DyDtMod

IMPLICIT NONE
PRIVATE

!  Define access to SUBROUTINEs.

PUBLIC :: rk1412FeaginEachStep
! https://sce.uhcl.edu/rungekutta/rk1412.txt
! THE COEFFICIENTS OF RK14(12) TO 60 DIGITS
! using the notation of Fehlberg,  Bettis,  Horn,  et alia.


! k[i] are the nodes 
REAL(KIND=8), PARAMETER, PRIVATE :: &
 k0=0.0D0,&
 k1=0.111111111111111111111111111111111111111111111111111111111111D0,&
 k2=0.555555555555555555555555555555555555555555555555555555555556D0,&
 k3=0.833333333333333333333333333333333333333333333333333333333333D0,&
 k4=0.333333333333333333333333333333333333333333333333333333333333D0,&
 k5=1.0D0,&
 k6=0.669986979272772921764683785505998513938845229638460353285142D0,&
 k7=0.297068384213818357389584716808219413223332094698915687379168D0,&
 k8=0.727272727272727272727272727272727272727272727272727272727273D0,&
 k9=0.140152799042188765276187487966946717629806463082532936287323D0,&
 k10=0.700701039770150737151099854830749337941407049265546408969222D0,&
 k11=0.363636363636363636363636363636363636363636363636363636363636D0,&
 k12=0.263157894736842105263157894736842105263157894736842105263158D0,&
 k13=3.92172246650270859125196642501208648863714315266128052078483D-2,&
 k14=0.812917502928376762983393159278036506189612372617238550774312D0,&
 k15=0.166666666666666666666666666666666666666666666666666666666667D0,&
 k16=0.9D0,&
 k17=6.41299257451966923312771193896682809481096651615083225402924D-2,&
 k18=0.20414990928342884892774463430102340502714950524133375162887D0,&
 k19=0.395350391048760565615671369827324372352227297456659450554577D0,&
 k20=0.604649608951239434384328630172675627647772702543340549445423D0,&
 k21=0.79585009071657115107225536569897659497285049475866624837113D0,&
 k22=0.935870074254803307668722880610331719051890334838491677459708D0,&
 k23=0.166666666666666666666666666666666666666666666666666666666667D0,&
 k24=0.812917502928376762983393159278036506189612372617238550774312D0,&
 k25=3.92172246650270859125196642501208648863714315266128052078483D-2,&
 k26=0.363636363636363636363636363636363636363636363636363636363636D0,&
 k27=0.700701039770150737151099854830749337941407049265546408969222D0,&
 k28=0.140152799042188765276187487966946717629806463082532936287323D0,&
 k29=0.297068384213818357389584716808219413223332094698915687379168D0,&
 k30=0.669986979272772921764683785505998513938845229638460353285142D0,&
 k31=0.333333333333333333333333333333333333333333333333333333333333D0,&
 k32=0.555555555555555555555555555555555555555555555555555555555556D0,&
 k33=0.111111111111111111111111111111111111111111111111111111111111D0,&
 k34=1.0D0
! b[i] are coefficients for nodes k[i] 
REAL(KIND=8), PARAMETER, PRIVATE :: &
 b0=1.78571428571428571428571428571428571428571428571428571428571D-2,&
 b1=5.859375D-3,&
 b2=1.171875D-2,&
 b3=0.0D0,&
 b4=1.7578125D-2,&
 b5=0.0D0,&
 b6=2.34375D-2,&
 b7=2.9296875D-2,&
 b8=0.0D0,&
 b9=3.515625D-2,&
 b10=4.1015625D-2,&
 b11=4.6875D-2,&
 b12=0.0D0,&
 b13=5.2734375D-2,&
 b14=5.859375D-2,&
 b15=6.4453125D-2,&
 b16=0.0D0,&
 b17=0.10535211357175301969149603288787816222767308308052388404167D0,&
 b18=0.170561346241752182382120338553874085887555487802790804737501D0,&
 b19=0.206229397329351940783526485701104894741914286259542454077972D0,&
 b20=0.206229397329351940783526485701104894741914286259542454077972D0,&
 b21=0.170561346241752182382120338553874085887555487802790804737501D0,&
 b22=0.10535211357175301969149603288787816222767308308052388404167D0,&
 b23=-6.4453125D-2,&
 b24=-5.859375D-2,&
 b25=-5.2734375D-2,&
 b26=-4.6875D-2,&
 b27=-4.1015625D-2,&
 b28=-3.515625D-2,&
 b29=-2.9296875D-2,&
 b30=-2.34375D-2,&
 b31=-1.7578125D-2,&
 b32=-1.171875D-2,&
 b33=-5.859375D-3,&
 b34=1.78571428571428571428571428571428571428571428571428571428571D-2
! a[i,j] 
REAL(KIND=8), PARAMETER, PRIVATE :: &
 a1_0=0.111111111111111111111111111111111111111111111111111111111111D0,&
 a2_0=-0.833333333333333333333333333333333333333333333333333333333333D0,&
 a2_1=1.38888888888888888888888888888888888888888888888888888888889D0,&
 a3_0=0.208333333333333333333333333333333333333333333333333333333333D0,&
 a3_1=0.0D0,&
 a3_2=0.625D0,&
 a4_0=0.193333333333333333333333333333333333333333333333333333333333D0,&
 a4_1=0.0D0,&
 a4_2=0.22D0,&
 a4_3=-8.0D-2,&
 a5_0=0.1D0,&
 a5_1=0.0D0,&
 a5_2=0.0D0,&
 a5_3=0.4D0,&
 a5_4=0.5D0,&
 a6_0=0.103484561636679776672993546511910344499744798201971316606663D0,&
 a6_1=0.0D0,&
 a6_2=0.0D0,&
 a6_3=0.122068887306407222589644082868962077139592714834162134741275D0,&
 a6_4=0.482574490331246622475134780125688112865919023850168049679402D0,&
 a6_5=-3.8140960001560699973088624000562020566411307247841147742197D-2,&
 a7_0=0.124380526654094412881516420868799316268491466359671423163289D0,&
 a7_1=0.0D0,&
 a7_2=0.0D0,&
 a7_3=0.0D0,&
 a7_4=0.226120282197584301422238662979202901196752320742633143965145D0,&
 a7_5=1.37885887618080880607695837016477814530969417491493385363543D-2,&
 a7_6=-6.722101339966844497493995074143058569500863415253821828562D-2,&
 a8_0=9.36919065659673815530885456083005933866349695217750085655603D-2,&
 a8_1=0.0D0,&
 a8_2=0.0D0,&
 a8_3=0.0D0,&
 a8_4=0.0D0,&
 a8_5=-6.13406843450510987229498995641664735620914507128858871007099D-3,&
 a8_6=0.216019825625503063708860097659866573490979433278117320188668D0,&
 a8_7=0.423695063515761937337619073960976753205867469544123532683116D0,&
 a9_0=8.38479812409052664616968791372814085980533139224911131069335D-2,&
 a9_1=0.0D0,&
 a9_2=0.0D0,&
 a9_3=0.0D0,&
 a9_4=0.0D0,&
 a9_5=-1.17949367100973814319755056031295775367961960590736150777613D-2,&
 a9_6=-0.247299020568812652339473838743194598325992840353340132697498D0,&
 a9_7=9.78080858367729012259313014081291665503740655476733940756599D-2,&
 a9_8=0.217590689243420631360008651767860318344168120024782176879989D0,&
 a10_0=6.1525535976942822795456238961431471433342396906482110745394D-2,&
 a10_1=0.0D0,&
 a10_2=0.0D0,&
 a10_3=0.0D0,&
 a10_4=0.0D0,&
 a10_5=5.9223278032450330804299000579804652473838956044425713683499D-3,&
 a10_6=0.470326159963841112217224303205894113455362530746108825010848D0,&
 a10_7=0.299688863848679000853981837096192399136831121671781279184194D0,&
 a10_8=-0.247656877593994914689992276329810825853958069263947095548189D0,&
 a10_9=0.110895029771437682893999851839061714522445173600678718208625D0,&
 a11_0=4.19700073362782579861792864787277787213483656543104611245994D-2,&
 a11_1=0.0D0,&
 a11_2=0.0D0,&
 a11_3=0.0D0,&
 a11_4=0.0D0,&
 a11_5=-3.17987696266205093901912847692712407988609169703103952205634D-3,&
 a11_6=0.806397714906192077260821711520379506393543111567419750119748D0,&
 a11_7=9.75983126412388979093522850684288851314672048003054550357187D-2,&
 a11_8=0.778575578158398909027512446452927238999763460594181964958853D0,&
 a11_9=0.204890423831599428189499202098105603312029235081420653574829D0,&
 a11_10=-1.56261579627468188307070943950527825211462892236424360892806D0,&
 a12_0=4.37726782233730163574465242495339811688214967071614123256973D-2,&
 a12_1=0.0D0,&
 a12_2=0.0D0,&
 a12_3=0.0D0,&
 a12_4=0.0D0,&
 a12_5=0.0D0,&
 a12_6=0.0D0,&
 a12_7=0.0D0,&
 a12_8=6.2436502752019520879435862858093362528163121690309591720125D-3,&
 a12_9=0.200043097109577314994435165469647856829066232218264969608768D0,&
 a12_10=-8.05328367804983036823857162048902911923392887337029314844206D-3,&
 a12_11=2.11517528067396521915711903523399601316877825157550573051221D-2,&
 a13_0=2.83499250363514563095023591920717312247137654896477097768495D-2,&
 a13_1=0.0D0,&
 a13_2=0.0D0,&
 a13_3=0.0D0,&
 a13_4=0.0D0,&
 a13_5=0.0D0,&
 a13_6=0.0D0,&
 a13_7=0.0D0,&
 a13_8=2.49163204855817407538949148805995149459884653585417680098222D-3,&
 a13_9=2.30138787854593149638399846373742768772087122638142234223658D-2,&
 a13_10=-3.22155956692977098724476092467120878189463604760620461043308D-3,&
 a13_11=9.88442549447664668946335414487885256040819982786014648129297D-3,&
 a13_12=-2.13010771328887351384307642875927384886634565429572466632092D-2,&
 a14_0=0.343511894290243001049432234735147943083353174980701426268122D0,&
 a14_1=0.0D0,&
 a14_2=0.0D0,&
 a14_3=0.0D0,&
 a14_4=0.0D0,&
 a14_5=0.0D0,&
 a14_6=0.0D0,&
 a14_7=0.0D0,&
 a14_8=0.210451912023627385609097011999010655788807405225626700040882D0,&
 a14_9=1.03427452057230411936482926828825709938667999698324740166559D0,&
 a14_10=6.00303645864422487051240448206640574939078092406156945568306D-3,&
 a14_11=0.855938125099619537578012106002407728915062652616416005816477D0,&
 a14_12=-0.977235005036766810872264852372525633013107656892839677696022D0,&
 a14_13=-0.660026980479294694616225013856327693720573981219974874776419D0,&
 a15_0=-1.43574001672168069538206399935076366657755954378399880691949D-2,&
 a15_1=0.0D0,&
 a15_2=0.0D0,&
 a15_3=0.0D0,&
 a15_4=0.0D0,&
 a15_5=0.0D0,&
 a15_6=0.0D0,&
 a15_7=0.0D0,&
 a15_8=-3.66253270049039970293685796848974791733119081733552207318285D-2,&
 a15_9=3.50254975636213681976849406979846524346789082471103574920148D-2,&
 a15_10=3.60946016362113508931786658758335239823689929864237671348749D-2,&
 a15_11=-2.65219967553681106351595946834601923649627012457464284442911D-2,&
 a15_12=4.45699011305698119638911537508839908104336323082226770910408D-2,&
 a15_13=0.124343093331358243286225595741786448038973408895106741855721D0,&
 a15_14=4.13829693239480694403512496204335960426192908674476033832967D-3,&
 a16_0=0.356032404425120290975609116398089176264106222379748802654822D0,&
 a16_1=0.0D0,&
 a16_2=0.0D0,&
 a16_3=0.0D0,&
 a16_4=0.0D0,&
 a16_5=0.0D0,&
 a16_6=0.0D0,&
 a16_7=0.0D0,&
 a16_8=-0.450192758947562595966821779075956175110645100214763601190349D0,&
 a16_9=0.430527907083710898626656292808782917793030154094709462877146D0,&
 a16_10=0.511973029011022237668556960394071692077125787030651386389972D0,&
 a16_11=0.908303638886404260390159124638110213997496214819904630546596D0,&
 a16_12=-1.2392109337193393175737246915153402885441388924860572618652D0,&
 a16_13=-0.649048661671761465141672348879062553905402831967191097656668D0,&
 a16_14=0.251708904586819292210480529948970541404887852931447491219418D0,&
 a16_15=0.779906470345586398810756795282334476023540593411550187024263D0,&
 a17_0=1.30935687406513066406881206418834980127470438213192487844956D-2,&
 a17_1=0.0D0,&
 a17_2=0.0D0,&
 a17_3=0.0D0,&
 a17_4=0.0D0,&
 a17_5=0.0D0,&
 a17_6=0.0D0,&
 a17_7=0.0D0,&
 a17_8=0.0D0,&
 a17_9=0.0D0,&
 a17_10=0.0D0,&
 a17_11=0.0D0,&
 a17_12=-9.32053067985113945908461962767108237858631509684667142124826D-5,&
 a17_13=5.05374334262299359640090443138590726770942344716122381702746D-2,&
 a17_14=8.04470341944487979109579109610197797641311868930865361048975D-7,&
 a17_15=5.91726029494171190528755742777717259844340971924321528178248D-4,&
 a17_16=-4.01614722154557337064691684906375587732264247950093804676867D-7,&
 a18_0=2.07926484466053012541944544000765652167255206144373407979758D-2,&
 a18_1=0.0D0,&
 a18_2=0.0D0,&
 a18_3=0.0D0,&
 a18_4=0.0D0,&
 a18_5=0.0D0,&
 a18_6=0.0D0,&
 a18_7=0.0D0,&
 a18_8=0.0D0,&
 a18_9=0.0D0,&
 a18_10=0.0D0,&
 a18_11=0.0D0,&
 a18_12=5.82695918800085915101902697837284108951406103029871570103075D-4,&
 a18_13=-8.01700732358815939083342186525852746640558465919633524655451D-3,&
 a18_14=4.03847643847136940375170821743560570484117290330895506618968D-6,&
 a18_15=8.54609998055506144225056114567535602510114622033622491802597D-2,&
 a18_16=-2.04486480935804242706707569691004307904442837552677456232848D-6,&
 a18_17=0.105328578824431893399799402979093997354240904235172843146582D0,&
 a19_0=1.40153449795736021415446247355771306718486452917597731683689D0,&
 a19_1=0.0D0,&
 a19_2=0.0D0,&
 a19_3=0.0D0,&
 a19_4=0.0D0,&
 a19_5=0.0D0,&
 a19_6=0.0D0,&
 a19_7=0.0D0,&
 a19_8=0.0D0,&
 a19_9=0.0D0,&
 a19_10=0.0D0,&
 a19_11=0.0D0,&
 a19_12=-0.230252000984221261616272410367415621261130298274455611733277D0,&
 a19_13=-7.21106840466912905659582237106874247165856493509961561958267D0,&
 a19_14=3.72901560694836335236995327852132340217759566678662385552634D-3,&
 a19_15=-4.71415495727125020678778179392224757011323373221820091641216D0,&
 a19_16=-1.76367657545349242053841995032797673574903886695600132759652D-3,&
 a19_17=7.64130548038698765563029310880237651185173367813936997648198D0,&
 a19_18=3.50602043659751834989896082949744710968212949893375368243588D0,&
 a20_0=11.9514650694120686799372385830716401674473610826553517297976D0,&
 a20_1=0.0D0,&
 a20_2=0.0D0,&
 a20_3=0.0D0,&
 a20_4=0.0D0,&
 a20_5=0.0D0,&
 a20_6=0.0D0,&
 a20_7=0.0D0,&
 a20_8=0.0D0,&
 a20_9=0.0D0,&
 a20_10=0.0D0,&
 a20_11=0.0D0,&
 a20_12=7.79480932108175968783516700231764388220284279598980948538579D0,&
 a20_13=-56.4501393867325792523560991120904281440468100061340556540132D0,&
 a20_14=9.12376306930644901344530449290276645709607450403673704844997D-2,&
 a20_15=-12.7336279925434886201945524309199275038162717529918963305155D0,&
 a20_16=-3.96895921904719712313542810939736674712383070433147873009352D-2,&
 a20_17=54.4392141883570886996225765155307791861438378423305337073797D0,&
 a20_18=-3.64411637921569236846406990361350645806721478409266709351203D0,&
 a20_19=-0.804503249910509910899030787958579499315694913210787878260459D0,&
 a21_0=-148.80942650710048842783886826864762556193061208214859707669D0,&
 a21_1=0.0D0,&
 a21_2=0.0D0,&
 a21_3=0.0D0,&
 a21_4=0.0D0,&
 a21_5=0.0D0,&
 a21_6=0.0D0,&
 a21_7=0.0D0,&
 a21_8=0.0D0,&
 a21_9=0.0D0,&
 a21_10=0.0D0,&
 a21_11=0.0D0,&
 a21_12=-91.7295278291256484357935662402321623495228729036354276506427D0,&
 a21_13=707.656144971598359834575719286335716154821128966649565194286D0,&
 a21_14=-1.1056361185748244090529696131159093080133830894263776955554D0,&
 a21_15=176.134591883811372587859898076055660406999516762301689616841D0,&
 a21_16=0.491384824214880662268898345164454557416884631402764792538746D0,&
 a21_17=-684.278000449814944358237535610895081956077167893600278300805D0,&
 a21_18=27.9910604998398258984224332124380407446002518400668657974589D0,&
 a21_19=13.1939710030282333443670964371153238435064159623744975073252D0,&
 a21_20=1.25128781283980445450114974148056006317268830077396406361417D0,&
 a22_0=-9.67307946948196763644126118433219395839951408571877262880482D0,&
 a22_1=0.0D0,&
 a22_2=0.0D0,&
 a22_3=0.0D0,&
 a22_4=0.0D0,&
 a22_5=0.0D0,&
 a22_6=0.0D0,&
 a22_7=0.0D0,&
 a22_8=0.0D0,&
 a22_9=0.0D0,&
 a22_10=0.0D0,&
 a22_11=0.0D0,&
 a22_12=-4.46990150858505531443846227701960360497830681408751431146712D0,&
 a22_13=45.5127128690952681968241950400052751178905907817398483534845D0,&
 a22_14=-7.13085086183826912791492024438246129930559805352394367050813D-2,&
 a22_15=11.227361406841274158259062447993938420782680077679448505154D0,&
 a22_16=0.126244376717622724516237912909138809361786889819105426371393D0,&
 a22_17=-43.5439339549483313605810624907242107623814304467621407753424D0,&
 a22_18=0.787174307543058978398792994996550902064546091443233850464377D0,&
 a22_19=0.532264696744684215669300708603886690785395776821503851830821D0,&
 a22_20=0.422422733996325326010225127471388772575086538809603346825334D0,&
 a22_21=8.59131249503067107308438031499859443441115056294154956487671D-2,&
 a23_0=-10.0664032447054702403396606900426891472202824757968765569183D0,&
 a23_1=0.0D0,&
 a23_2=0.0D0,&
 a23_3=0.0D0,&
 a23_4=0.0D0,&
 a23_5=0.0D0,&
 a23_6=0.0D0,&
 a23_7=0.0D0,&
 a23_8=-3.66253270049039970293685796848974791733119081733552207318285D-2,&
 a23_9=3.50254975636213681976849406979846524346789082471103574920148D-2,&
 a23_10=3.60946016362113508931786658758335239823689929864237671348749D-2,&
 a23_11=-2.65219967553681106351595946834601923649627012457464284442911D-2,&
 a23_12=-6.27088972181464143590553149478871603839356122957396018530209D0,&
 a23_13=48.2079237442562989090702103008195063923492593141636117832993D0,&
 a23_14=-6.94471689136165640882395180583732834557754169149088630301342D-2,&
 a23_15=12.6810690204850295698341370913609807066108483811412127009785D0,&
 a23_16=1.19671168968323754838161435501011294100927813964199613229864D-2,&
 a23_17=-46.7249764992482408003358268242662695593201321659795608950429D0,&
 a23_18=1.33029613326626711314710039298216591399033511191227101321435D0,&
 a23_19=1.0076678750339829835343890361992665777116271779366171970837D0,&
 a23_20=2.09512051933665091664122388475480702892770753864487241177616D-2,&
 a23_21=2.10134706331264177317735424331396407424412188443757490871603D-2,&
 a23_22=9.52196014417121794175101542454575907376360233658356240547761D-3,&
 a24_0=-409.478081677743708772589097409370357624424341606752069725341D0,&
 a24_1=0.0D0,&
 a24_2=0.0D0,&
 a24_3=0.0D0,&
 a24_4=0.0D0,&
 a24_5=0.0D0,&
 a24_6=0.0D0,&
 a24_7=0.0D0,&
 a24_8=0.210451912023627385609097011999010655788807405225626700040882D0,&
 a24_9=1.03427452057230411936482926828825709938667999698324740166559D0,&
 a24_10=6.00303645864422487051240448206640574939078092406156945568306D-3,&
 a24_11=0.855938125099619537578012106002407728915062652616416005816477D0,&
 a24_12=-250.51699854744786049277765772931613038658405042078207596699D0,&
 a24_13=1946.42466652388427766053750328264758595829850895761428240231D0,&
 a24_14=-3.04503882102310365506105809086860882786950544097602101685174D0,&
 a24_15=490.62637952828171352120826529916808384159854227406167157623D0,&
 a24_16=1.56647589531270907115484067013597445739595615245966775329993D0,&
 a24_17=-1881.97428994011173362217267377035870619215906638453056643641D0,&
 a24_18=75.2592224724847175278837713643303149821620618914245864351135D0,&
 a24_19=34.5734356980331067622434344736554689696728644793551014989002D0,&
 a24_20=3.21147679440968961435417361847073755169022966748891627882572D0,&
 a24_21=-0.460408041738414391307201404237058848867245095265382820823055D0,&
 a24_22=-8.70718339841810522431884137957986245724252047388936572215438D-2,&
 a24_23=-7.39351814158303067567016952195521063999185773249132944724553D0,&
 a25_0=3.43347475853550878921093496257596781120623891072008459930197D0,&
 a25_1=0.0D0,&
 a25_2=0.0D0,&
 a25_3=0.0D0,&
 a25_4=0.0D0,&
 a25_5=0.0D0,&
 a25_6=0.0D0,&
 a25_7=0.0D0,&
 a25_8=2.49163204855817407538949148805995149459884653585417680098222D-3,&
 a25_9=2.30138787854593149638399846373742768772087122638142234223658D-2,&
 a25_10=-3.22155956692977098724476092467120878189463604760620461043308D-3,&
 a25_11=9.88442549447664668946335414487885256040819982786014648129297D-3,&
 a25_12=2.1625279937792250778830784190475735404575922533573270791653D0,&
 a25_13=-16.2699864546457421328065640660139489006987552040228852402716D0,&
 a25_14=-0.128534502120524552843583417470935010538029037542654506231743D0,&
 a25_15=-8.98915042666504253089307820833379330486511746063552853023189D0,&
 a25_16=-3.48595363232025333387080201851013650192401767250513765000963D-3,&
 a25_17=15.7936194113339807536235187388695574135853387025139738341334D0,&
 a25_18=-0.574403330914095065628165482017335820148383663195675408024658D0,&
 a25_19=-0.345602039021393296692722496608124982535237228827655306030152D0,&
 a25_20=-6.62241490206585091731619991383757781133067992707418687587487D-3,&
 a25_21=-7.7778812924220416403254645860736430975934720962675911194615D-3,&
 a25_22=-3.56084192402274913338827232697437364675240818791706587952939D-3,&
 a25_23=4.79282506449930799649797749629840189457296934139359048988332D0,&
 a25_24=0.153725464873068577844576387402512082757034273069877432944621D0,&
 a26_0=32.3038520871985442326994734440031535091364975047784630088983D0,&
 a26_1=0.0D0,&
 a26_2=0.0D0,&
 a26_3=0.0D0,&
 a26_4=0.0D0,&
 a26_5=-3.17987696266205093901912847692712407988609169703103952205634D-3,&
 a26_6=0.806397714906192077260821711520379506393543111567419750119748D0,&
 a26_7=9.75983126412388979093522850684288851314672048003054550357187D-2,&
 a26_8=0.778575578158398909027512446452927238999763460594181964958853D0,&
 a26_9=0.204890423831599428189499202098105603312029235081420653574829D0,&
 a26_10=-1.56261579627468188307070943950527825211462892236424360892806D0,&
 a26_11=0.0D0,&
 a26_12=16.3429891882310570648504243973927174708753353504154550405647D0,&
 a26_13=-154.544555293543621230730189631471036399316683669609116705323D0,&
 a26_14=1.56971088703334872692034283417621761466263593582497085955201D0,&
 a26_15=3.27685545087248131321429817269900731165522404974733504794135D0,&
 a26_16=-5.03489245193653176348040727199783626534081095691632396802451D-2,&
 a26_17=153.321151858041665070593767885914694011224363102594556731397D0,&
 a26_18=7.17568186327720495846766484814784143567826308034865369443637D0,&
 a26_19=-2.94036748675300481945917659896930989215320594380777597403592D0,&
 a26_20=-6.65845946076803144470749676022628870281920493197256887985612D-2,&
 a26_21=-4.62346054990843661229248668562217261176966514016859284197145D-2,&
 a26_22=-2.04198733585679401539388228617269778848579774821581777675337D-2,&
 a26_23=-53.3523106438735850515953441165998107974045090495791591218714D0,&
 a26_24=-1.35548714715078654978732186705996404017554501614191325114947D0,&
 a26_25=-1.57196275801232751882901735171459249177687219114442583461866D0,&
 a27_0=-16.6451467486341512872031294403931758764560371130818978459405D0,&
 a27_1=0.0D0,&
 a27_2=0.0D0,&
 a27_3=0.0D0,&
 a27_4=0.0D0,&
 a27_5=5.9223278032450330804299000579804652473838956044425713683499D-3,&
 a27_6=0.470326159963841112217224303205894113455362530746108825010848D0,&
 a27_7=0.299688863848679000853981837096192399136831121671781279184194D0,&
 a27_8=-0.247656877593994914689992276329810825853958069263947095548189D0,&
 a27_9=0.110895029771437682893999851839061714522445173600678718208625D0,&
 a27_10=0.0D0,&
 a27_11=-0.491719043846229147070666628704194097678081907210673044988866D0,&
 a27_12=-11.4743154427289496968389492564352536350842454130853175250727D0,&
 a27_13=80.2593166576230272541702485886484400152793366623589989106256D0,&
 a27_14=-0.384132303980042847625312526759029103746926841342088219165648D0,&
 a27_15=7.28147667468107583471326950926136115767612581862877764249646D0,&
 a27_16=-0.132699384612248379510571708176035274836827341616751884314074D0,&
 a27_17=-81.0799832525730726674679289752255240006070716633632990308935D0,&
 a27_18=-1.25037492835620639521768185656179119962253747492403205797494D0,&
 a27_19=2.59263594969543681023776379504377324994226447359296887778718D0,&
 a27_20=-0.301440298346404539830163997260526875264431537275641495291993D0,&
 a27_21=0.22138446078983233745170645157277379169524683905731841430102D0,&
 a27_22=8.2757727477189293195598987097469315299627643542980989055121D-2,&
 a27_23=18.9960662040611520464672450037243263998175161412237156872211D0,&
 a27_24=0.269231946409639685623468015128334167460051910348912845121977D0,&
 a27_25=1.6267482744706653746298936492962893398812502928418368027902D0,&
 a27_26=0.491719043846229147070666628704194097678081907210673044988866D0,&
 a28_0=8.38479812409052664616968791372814085980533139224911131069335D-2,&
 a28_1=0.0D0,&
 a28_2=0.0D0,&
 a28_3=0.0D0,&
 a28_4=0.0D0,&
 a28_5=-1.17949367100973814319755056031295775367961960590736150777613D-2,&
 a28_6=-0.247299020568812652339473838743194598325992840353340132697498D0,&
 a28_7=9.78080858367729012259313014081291665503740655476733940756599D-2,&
 a28_8=0.217590689243420631360008651767860318344168120024782176879989D0,&
 a28_9=0.0D0,&
 a28_10=0.13758560676332522486565963219678774664744722297508486597544D0,&
 a28_11=4.39870229715046685058790092341545026046103890294261359042581D-2,&
 a28_12=0.0D0,&
 a28_13=-0.513700813768193341957004456618630303738757363641964030086972D0,&
 a28_14=0.826355691151315508644211308399153458701423158616168576922372D0,&
 a28_15=25.7018139719811832625873882972519939511136556341960074626615D0,&
 a28_16=0.0D0,&
 a28_17=0.0D0,&
 a28_18=0.0D0,&
 a28_19=0.0D0,&
 a28_20=0.0D0,&
 a28_21=0.0D0,&
 a28_22=0.0D0,&
 a28_23=-25.7018139719811832625873882972519939511136556341960074626615D0,&
 a28_24=-0.826355691151315508644211308399153458701423158616168576922372D0,&
 a28_25=0.513700813768193341957004456618630303738757363641964030086972D0,&
 a28_26=-4.39870229715046685058790092341545026046103890294261359042581D-2,&
 a28_27=-0.13758560676332522486565963219678774664744722297508486597544D0,&
 a29_0=0.124380526654094412881516420868799316268491466359671423163289D0,&
 a29_1=0.0D0,&
 a29_2=0.0D0,&
 a29_3=0.0D0,&
 a29_4=0.226120282197584301422238662979202901196752320742633143965145D0,&
 a29_5=1.37885887618080880607695837016477814530969417491493385363543D-2,&
 a29_6=-6.722101339966844497493995074143058569500863415253821828562D-2,&
 a29_7=0.0D0,&
 a29_8=0.0D0,&
 a29_9=-0.856238975085428354755349769879501772112121597411563802855067D0,&
 a29_10=-1.96337522866858908928262850028093813988180440518267404553576D0,&
 a29_11=-0.232332822724119401237246257308921847250108199230419994978218D0,&
 a29_12=0.0D0,&
 a29_13=4.30660719086453349461668936876562947772432562053478092626764D0,&
 a29_14=-2.92722963249465482659787911202390446687687394950633612630592D0,&
 a29_15=-82.3131666397858944454492334105458707735761966428138676971041D0,&
 a29_16=0.0D0,&
 a29_17=0.0D0,&
 a29_18=0.0D0,&
 a29_19=0.0D0,&
 a29_20=0.0D0,&
 a29_21=0.0D0,&
 a29_22=0.0D0,&
 a29_23=82.3131666397858944454492334105458707735761966428138676971041D0,&
 a29_24=2.92722963249465482659787911202390446687687394950633612630592D0,&
 a29_25=-4.30660719086453349461668936876562947772432562053478092626764D0,&
 a29_26=0.232332822724119401237246257308921847250108199230419994978218D0,&
 a29_27=1.96337522866858908928262850028093813988180440518267404553576D0,&
 a29_28=0.856238975085428354755349769879501772112121597411563802855067D0,&
 a30_0=0.103484561636679776672993546511910344499744798201971316606663D0,&
 a30_1=0.0D0,&
 a30_2=0.0D0,&
 a30_3=0.122068887306407222589644082868962077139592714834162134741275D0,&
 a30_4=0.482574490331246622475134780125688112865919023850168049679402D0,&
 a30_5=-3.8140960001560699973088624000562020566411307247841147742197D-2,&
 a30_6=0.0D0,&
 a30_7=-0.550499525310802324138388507020508177411414311000037561712836D0,&
 a30_8=0.0D0,&
 a30_9=-0.711915811585189227887648262043794387578291882406745570495765D0,&
 a30_10=-0.584129605671551340432988730158480872095335329645227595707052D0,&
 a30_11=0.0D0,&
 a30_12=0.0D0,&
 a30_13=2.11046308125864932128717300046622750300375054278936987850718D0,&
 a30_14=-8.37494736739572135525742023001037992695260175335123517729291D-2,&
 a30_15=5.10021499072320914075295969043344113107545060862804249161191D0,&
 a30_16=0.0D0,&
 a30_17=0.0D0,&
 a30_18=0.0D0,&
 a30_19=0.0D0,&
 a30_20=0.0D0,&
 a30_21=0.0D0,&
 a30_22=0.0D0,&
 a30_23=-5.10021499072320914075295969043344113107545060862804249161191D0,&
 a30_24=8.37494736739572135525742023001037992695260175335123517729291D-2,&
 a30_25=-2.11046308125864932128717300046622750300375054278936987850718D0,&
 a30_26=0.0D0,&
 a30_27=0.584129605671551340432988730158480872095335329645227595707052D0,&
 a30_28=0.711915811585189227887648262043794387578291882406745570495765D0,&
 a30_29=0.550499525310802324138388507020508177411414311000037561712836D0,&
 a31_0=0.193333333333333333333333333333333333333333333333333333333333D0,&
 a31_1=0.0D0,&
 a31_2=0.22D0,&
 a31_3=-8.0D-2,&
 a31_4=0.0D0,&
 a31_5=0.0D0,&
 a31_6=0.109993425580724703919462404865068340845119058295846426463652D0,&
 a31_7=-0.254297048076270161384068506997153122141835626976703920846242D0,&
 a31_8=0.0D0,&
 a31_9=0.865570777116694254343770343821098281832847401233011859346737D0,&
 a31_10=3.324164491140930831067995527865720183368600929369864071602D0,&
 a31_11=0.0D0,&
 a31_12=0.0D0,&
 a31_13=-12.0102223315977933882352385148661841260301942633996815127277D0,&
 a31_14=0.476601466242493239430442776862061899602963782003580209476163D0,&
 a31_15=-29.0243011221036390525802623213654099596251221332470910692353D0,&
 a31_16=0.0D0,&
 a31_17=0.0D0,&
 a31_18=0.0D0,&
 a31_19=0.0D0,&
 a31_20=0.0D0,&
 a31_21=0.0D0,&
 a31_22=0.0D0,&
 a31_23=29.0243011221036390525802623213654099596251221332470910692353D0,&
 a31_24=-0.476601466242493239430442776862061899602963782003580209476163D0,&
 a31_25=12.0102223315977933882352385148661841260301942633996815127277D0,&
 a31_26=0.0D0,&
 a31_27=-3.324164491140930831067995527865720183368600929369864071602D0,&
 a31_28=-0.865570777116694254343770343821098281832847401233011859346737D0,&
 a31_29=0.254297048076270161384068506997153122141835626976703920846242D0,&
 a31_30=-0.109993425580724703919462404865068340845119058295846426463652D0,&
 a32_0=-0.833333333333333333333333333333333333333333333333333333333333D0,&
 a32_1=1.38888888888888888888888888888888888888888888888888888888889D0,&
 a32_2=0.0D0,&
 a32_3=0.0D0,&
 a32_4=-0.75D0,&
 a32_5=0.0D0,&
 a32_6=-0.492529543718026304422682049114021320200214681580657784719074D0,&
 a32_7=0.0D0,&
 a32_8=0.0D0,&
 a32_9=0.0D0,&
 a32_10=0.0D0,&
 a32_11=0.0D0,&
 a32_12=0.0D0,&
 a32_13=0.0D0,&
 a32_14=0.0D0,&
 a32_15=0.0D0,&
 a32_16=0.0D0,&
 a32_17=0.0D0,&
 a32_18=0.0D0,&
 a32_19=0.0D0,&
 a32_20=0.0D0,&
 a32_21=0.0D0,&
 a32_22=0.0D0,&
 a32_23=0.0D0,&
 a32_24=0.0D0,&
 a32_25=0.0D0,&
 a32_26=0.0D0,&
 a32_27=0.0D0,&
 a32_28=0.0D0,&
 a32_29=0.0D0,&
 a32_30=0.492529543718026304422682049114021320200214681580657784719074D0,&
 a32_31=0.75D0,&
 a33_0=0.111111111111111111111111111111111111111111111111111111111111D0,&
 a33_1=0.0D0,&
 a33_2=-0.222222222222222222222222222222222222222222222222222222222222D0,&
 a33_3=0.0D0,&
 a33_4=0.0D0,&
 a33_5=0.0D0,&
 a33_6=0.0D0,&
 a33_7=0.0D0,&
 a33_8=0.0D0,&
 a33_9=0.0D0,&
 a33_10=0.0D0,&
 a33_11=0.0D0,&
 a33_12=0.0D0,&
 a33_13=0.0D0,&
 a33_14=0.0D0,&
 a33_15=0.0D0,&
 a33_16=0.0D0,&
 a33_17=0.0D0,&
 a33_18=0.0D0,&
 a33_19=0.0D0,&
 a33_20=0.0D0,&
 a33_21=0.0D0,&
 a33_22=0.0D0,&
 a33_23=0.0D0,&
 a33_24=0.0D0,&
 a33_25=0.0D0,&
 a33_26=0.0D0,&
 a33_27=0.0D0,&
 a33_28=0.0D0,&
 a33_29=0.0D0,&
 a33_30=0.0D0,&
 a33_31=0.0D0,&
 a33_32=0.222222222222222222222222222222222222222222222222222222222222D0,&
 a34_0=0.285835140388971558796088842163836414852927537894596466840753D0,&
 a34_1=0.291666666666666666666666666666666666666666666666666666666667D0,&
 a34_2=0.21875D0,&
 a34_3=0.0D0,&
 a34_4=0.1640625D0,&
 a34_5=0.0D0,&
 a34_6=0.218194354945556658327188241581352107093288824322187941141516D0,&
 a34_7=0.180392898478697766863635221946775437719620053641849228562435D0,&
 a34_8=0.0D0,&
 a34_9=0.205713839404845018859120755122929542277570094982808905393991D0,&
 a34_10=0.242715791581770239970282927959446515762745971386670541948576D0,&
 a34_11=0.246465780813629305833609291181891407799228103869305705137021D0,&
 a34_12=-3.44991940790890824979834154601622662060370460614931644223924D0,&
 a34_13=0.228875562160036081760729060738458584294220372552740218459295D0,&
 a34_14=0.283290599702151415321527419056733335978436595493855789831434D0,&
 a34_15=3.21085125837766640960131490544236787005557320332238705967955D0,&
 a34_16=-0.223538777364845699920233756214162507964125230083674032084065D0,&
 a34_17=-0.707121157204419073518727286207487212130091231955206160635271D0,&
 a34_18=3.21123345150287080408174729202856500893260034443022374267639D0,&
 a34_19=1.40954348309669766030414474301123175769045945573548986335553D0,&
 a34_20=-0.151362053443742613121602276742518111090963026203676055891793D0,&
 a34_21=0.372350574527014276454724080214619984397121028202148298716575D0,&
 a34_22=0.252978746406361336722199907762141285915775728129414319261111D0,&
 a34_23=-3.21085125837766640960131490544236787005557320332238705967955D0,&
 a34_24=-0.283290599702151415321527419056733335978436595493855789831434D0,&
 a34_25=-0.228875562160036081760729060738458584294220372552740218459295D0,&
 a34_26=-0.246465780813629305833609291181891407799228103869305705137021D0,&
 a34_27=-0.242715791581770239970282927959446515762745971386670541948576D0,&
 a34_28=-0.205713839404845018859120755122929542277570094982808905393991D0,&
 a34_29=-0.180392898478697766863635221946775437719620053641849228562435D0,&
 a34_30=-0.218194354945556658327188241581352107093288824322187941141516D0,&
 a34_31=-0.1640625D0,&
 a34_32=-0.21875D0,&
 a34_33=-0.291666666666666666666666666666666666666666666666666666666667D0
! The estimate of the local truncation error is  ( 1/1000 )  h ( f(t1,x1)-f(t33,x33) )


CONTAINS

SUBROUTINE rk1412FeaginEachStep(t,y0,yn,h,hnew,rerun,test)
 REAL(KIND=8), INTENT(IN) :: t
 REAL(KIND=8), DIMENSION(:), INTENT(IN) :: y0     ! y(t)
 REAL(KIND=8), DIMENSION(SIZE(y0)), INTENT(OUT) :: yn ! y(t+h)
 REAL(KIND=8), INTENT(IN) :: h ! initial step size
 REAL(KIND=8), INTENT(OUT) :: hnew       ! new step size
 LOGICAL, INTENT(OUT) :: test, rerun ! test=stop the program, rerun=re-run this step, reject
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: tolh ! the tolerance, determined by the problem
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: yerr ! the error between embedded method
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: ynp  ! the embedded
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: ymax ! the max value among y0 and yn
 REAL(KIND=8) :: err
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: y1,y2,y3,y4,y5,y6,y7,y8,y9, &
                                      y10,y11,y12,y13,y14,y15,y16,y17,y18, &
                                      y19,y20,y21,y22,y23,y24,y25,y26,y27, &
                                      y28,y29,y30,y31,y32,y33,y34
 REAL(KIND=8), DIMENSION(SIZE(y0)) :: dy0,dy1,dy2,dy3,dy4,dy5,dy6,dy7,dy8, &
                                      dy9,dy10,dy11,dy12,dy13,dy14,dy15,dy16,dy17, &
                                      dy18,dy19,dy20,dy21,dy22,dy23,dy24,dy25,dy26, &
                                      dy27,dy28,dy29,dy30,dy31,dy32,dy33,dy34
 INTEGER :: i
  test = .False.
  rerun = .False. 
  ! use y0 to get dy0
  CALL  dev(t,y0,dy0,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y1=y0+h*(a1_0*dy0)
  ! use y1 to get dy1
  CALL  dev(t,y1,dy1,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y2=y0+h*(a2_0*dy0+a2_1*dy1)
  ! use y2 to get dy2
  CALL  dev(t,y2,dy2,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y3=y0+h*(a3_0*dy0+a3_1*dy1+a3_2*dy2)
  ! use y3 to get dy3
  CALL  dev(t,y3,dy3,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y4=y0+h*(a4_0*dy0+a4_1*dy1+a4_2*dy2+a4_3*dy3)
  ! use y4 to get dy4
  CALL  dev(t,y4,dy4,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y5=y0+h*(a5_0*dy0+a5_1*dy1+a5_2*dy2+a5_3*dy3+a5_4*dy4)
  ! use y5 to get dy5
  CALL  dev(t,y5,dy5,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y6=y0+h*(a6_0*dy0+a6_1*dy1+a6_2*dy2+a6_3*dy3+a6_4*dy4+a6_5*dy5)
  ! use y6 to get dy6
  CALL  dev(t,y6,dy6,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y7=y0+h*(a7_0*dy0+a7_1*dy1+a7_2*dy2+a7_3*dy3+a7_4*dy4+a7_5*dy5 + &
        &  a7_6*dy6)
  ! use y7 to get dy7
  CALL  dev(t,y7,dy7,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y8=y0+h*(a8_0*dy0+a8_1*dy1+a8_2*dy2+a8_3*dy3+a8_4*dy4+a8_5*dy5 + &
        &  a8_6*dy6+a8_7*dy7)
  ! use y8 to get dy8
  CALL  dev(t,y8,dy8,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y9=y0+h*(a9_0*dy0+a9_1*dy1+a9_2*dy2+a9_3*dy3+a9_4*dy4+a9_5*dy5 + &
        &  a9_6*dy6+a9_7*dy7+a9_8*dy8)
  ! use y9 to get dy9
  CALL  dev(t,y9,dy9,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y10=y0+h*(a10_0*dy0+a10_1*dy1+a10_2*dy2+a10_3*dy3+a10_4*dy4+a10_5*dy5 + &
         &  a10_6*dy6+a10_7*dy7+a10_8*dy8+a10_9*dy9)
  ! use y10 to get dy10
  CALL  dev(t,y10,dy10,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y11=y0+h*(a11_0*dy0+a11_1*dy1+a11_2*dy2+a11_3*dy3+a11_4*dy4+a11_5*dy5 + &
         &  a11_6*dy6+a11_7*dy7+a11_8*dy8+a11_9*dy9+a11_10*dy10)
  ! use y11 to get dy11
  CALL  dev(t,y11,dy11,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y12=y0+h*(a12_0*dy0+a12_1*dy1+a12_2*dy2+a12_3*dy3+a12_4*dy4+a12_5*dy5 + &
         &  a12_6*dy6+a12_7*dy7+a12_8*dy8+a12_9*dy9+a12_10*dy10+a12_11*dy11)
  ! use y12 to get dy12
  CALL  dev(t,y12,dy12,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y13=y0+h*(a13_0*dy0+a13_1*dy1+a13_2*dy2+a13_3*dy3+a13_4*dy4+a13_5*dy5 + &
         &  a13_6*dy6+a13_7*dy7+a13_8*dy8+a13_9*dy9+a13_10*dy10+a13_11*dy11 + &
         &  a13_12*dy12)
  ! use y13 to get dy13
  CALL  dev(t,y13,dy13,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y14=y0+h*(a14_0*dy0+a14_1*dy1+a14_2*dy2+a14_3*dy3+a14_4*dy4+a14_5*dy5 + &
         &  a14_6*dy6+a14_7*dy7+a14_8*dy8+a14_9*dy9+a14_10*dy10+a14_11*dy11 + &
         &  a14_12*dy12+a14_13*dy13)
  ! use y14 to get dy14
  CALL  dev(t,y14,dy14,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y15=y0+h*(a15_0*dy0+a15_1*dy1+a15_2*dy2+a15_3*dy3+a15_4*dy4+a15_5*dy5 + &
         &  a15_6*dy6+a15_7*dy7+a15_8*dy8+a15_9*dy9+a15_10*dy10+a15_11*dy11 + &
         &  a15_12*dy12+a15_13*dy13+a15_14*dy14)
  ! use y15 to get dy15
  CALL  dev(t,y15,dy15,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y16=y0+h*(a16_0*dy0+a16_1*dy1+a16_2*dy2+a16_3*dy3+a16_4*dy4+a16_5*dy5 + &
         &  a16_6*dy6+a16_7*dy7+a16_8*dy8+a16_9*dy9+a16_10*dy10+a16_11*dy11 + &
         &  a16_12*dy12+a16_13*dy13+a16_14*dy14+a16_15*dy15)
  ! use y16 to get dy16
  CALL  dev(t,y16,dy16,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y17=y0+h*(a17_0*dy0+a17_1*dy1+a17_2*dy2+a17_3*dy3+a17_4*dy4+a17_5*dy5 + &
         &  a17_6*dy6+a17_7*dy7+a17_8*dy8+a17_9*dy9+a17_10*dy10+a17_11*dy11 + &
         &  a17_12*dy12+a17_13*dy13+a17_14*dy14+a17_15*dy15+a17_16*dy16)
  ! use y17 to get dy17
  CALL  dev(t,y17,dy17,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y18=y0+h*(a18_0*dy0+a18_1*dy1+a18_2*dy2+a18_3*dy3+a18_4*dy4+a18_5*dy5 + &
         &  a18_6*dy6+a18_7*dy7+a18_8*dy8+a18_9*dy9+a18_10*dy10+a18_11*dy11 + &
         &  a18_12*dy12+a18_13*dy13+a18_14*dy14+a18_15*dy15+a18_16*dy16+a18_17*dy17)
  ! use y18 to get dy18
  CALL  dev(t,y18,dy18,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y19=y0+h*(a19_0*dy0+a19_1*dy1+a19_2*dy2+a19_3*dy3+a19_4*dy4+a19_5*dy5 + &
         &  a19_6*dy6+a19_7*dy7+a19_8*dy8+a19_9*dy9+a19_10*dy10+a19_11*dy11 + &
         &  a19_12*dy12+a19_13*dy13+a19_14*dy14+a19_15*dy15+a19_16*dy16+a19_17*dy17 + &
         &  a19_18*dy18)
  ! use y19 to get dy19
  CALL  dev(t,y19,dy19,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y20=y0+h*(a20_0*dy0+a20_1*dy1+a20_2*dy2+a20_3*dy3+a20_4*dy4+a20_5*dy5 + &
         &  a20_6*dy6+a20_7*dy7+a20_8*dy8+a20_9*dy9+a20_10*dy10+a20_11*dy11 + &
         &  a20_12*dy12+a20_13*dy13+a20_14*dy14+a20_15*dy15+a20_16*dy16+a20_17*dy17 + &
         &  a20_18*dy18+a20_19*dy19)
  ! use y20 to get dy20
  CALL  dev(t,y20,dy20,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y21=y0+h*(a21_0*dy0+a21_1*dy1+a21_2*dy2+a21_3*dy3+a21_4*dy4+a21_5*dy5 + &
         &  a21_6*dy6+a21_7*dy7+a21_8*dy8+a21_9*dy9+a21_10*dy10+a21_11*dy11 + &
         &  a21_12*dy12+a21_13*dy13+a21_14*dy14+a21_15*dy15+a21_16*dy16+a21_17*dy17 + &
         &  a21_18*dy18+a21_19*dy19+a21_20*dy20)
  ! use y21 to get dy21
  CALL  dev(t,y21,dy21,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y22=y0+h*(a22_0*dy0+a22_1*dy1+a22_2*dy2+a22_3*dy3+a22_4*dy4+a22_5*dy5 + &
         &  a22_6*dy6+a22_7*dy7+a22_8*dy8+a22_9*dy9+a22_10*dy10+a22_11*dy11 + &
         &  a22_12*dy12+a22_13*dy13+a22_14*dy14+a22_15*dy15+a22_16*dy16+a22_17*dy17 + &
         &  a22_18*dy18+a22_19*dy19+a22_20*dy20+a22_21*dy21)
  ! use y22 to get dy22
  CALL  dev(t,y22,dy22,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y23=y0+h*(a23_0*dy0+a23_1*dy1+a23_2*dy2+a23_3*dy3+a23_4*dy4+a23_5*dy5 + &
         &  a23_6*dy6+a23_7*dy7+a23_8*dy8+a23_9*dy9+a23_10*dy10+a23_11*dy11 + &
         &  a23_12*dy12+a23_13*dy13+a23_14*dy14+a23_15*dy15+a23_16*dy16+a23_17*dy17 + &
         &  a23_18*dy18+a23_19*dy19+a23_20*dy20+a23_21*dy21+a23_22*dy22)
  ! use y23 to get dy23
  CALL  dev(t,y23,dy23,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y24=y0+h*(a24_0*dy0+a24_1*dy1+a24_2*dy2+a24_3*dy3+a24_4*dy4+a24_5*dy5 + &
         &  a24_6*dy6+a24_7*dy7+a24_8*dy8+a24_9*dy9+a24_10*dy10+a24_11*dy11 + &
         &  a24_12*dy12+a24_13*dy13+a24_14*dy14+a24_15*dy15+a24_16*dy16+a24_17*dy17 + &
         &  a24_18*dy18+a24_19*dy19+a24_20*dy20+a24_21*dy21+a24_22*dy22+a24_23*dy23)
  ! use y24 to get dy24
  CALL  dev(t,y24,dy24,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y25=y0+h*(a25_0*dy0+a25_1*dy1+a25_2*dy2+a25_3*dy3+a25_4*dy4+a25_5*dy5 + &
         &  a25_6*dy6+a25_7*dy7+a25_8*dy8+a25_9*dy9+a25_10*dy10+a25_11*dy11 + &
         &  a25_12*dy12+a25_13*dy13+a25_14*dy14+a25_15*dy15+a25_16*dy16+a25_17*dy17 + &
         &  a25_18*dy18+a25_19*dy19+a25_20*dy20+a25_21*dy21+a25_22*dy22+a25_23*dy23 + &
         &  a25_24*dy24)
  ! use y25 to get dy25
  CALL  dev(t,y25,dy25,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y26=y0+h*(a26_0*dy0+a26_1*dy1+a26_2*dy2+a26_3*dy3+a26_4*dy4+a26_5*dy5 + &
         &  a26_6*dy6+a26_7*dy7+a26_8*dy8+a26_9*dy9+a26_10*dy10+a26_11*dy11 + &
         &  a26_12*dy12+a26_13*dy13+a26_14*dy14+a26_15*dy15+a26_16*dy16+a26_17*dy17 + &
         &  a26_18*dy18+a26_19*dy19+a26_20*dy20+a26_21*dy21+a26_22*dy22+a26_23*dy23 + &
         &  a26_24*dy24+a26_25*dy25)
  ! use y26 to get dy26
  CALL  dev(t,y26,dy26,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y27=y0+h*(a27_0*dy0+a27_1*dy1+a27_2*dy2+a27_3*dy3+a27_4*dy4+a27_5*dy5 + &
         &  a27_6*dy6+a27_7*dy7+a27_8*dy8+a27_9*dy9+a27_10*dy10+a27_11*dy11 + &
         &  a27_12*dy12+a27_13*dy13+a27_14*dy14+a27_15*dy15+a27_16*dy16+a27_17*dy17 + &
         &  a27_18*dy18+a27_19*dy19+a27_20*dy20+a27_21*dy21+a27_22*dy22+a27_23*dy23 + &
         &  a27_24*dy24+a27_25*dy25+a27_26*dy26)
  ! use y27 to get dy27
  CALL  dev(t,y27,dy27,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y28=y0+h*(a28_0*dy0+a28_1*dy1+a28_2*dy2+a28_3*dy3+a28_4*dy4+a28_5*dy5 + &
         &  a28_6*dy6+a28_7*dy7+a28_8*dy8+a28_9*dy9+a28_10*dy10+a28_11*dy11 + &
         &  a28_12*dy12+a28_13*dy13+a28_14*dy14+a28_15*dy15+a28_16*dy16+a28_17*dy17 + &
         &  a28_18*dy18+a28_19*dy19+a28_20*dy20+a28_21*dy21+a28_22*dy22+a28_23*dy23 + &
         &  a28_24*dy24+a28_25*dy25+a28_26*dy26+a28_27*dy27)
  ! use y28 to get dy28
  CALL  dev(t,y28,dy28,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y29=y0+h*(a29_0*dy0+a29_1*dy1+a29_2*dy2+a29_3*dy3+a29_4*dy4+a29_5*dy5 + &
         &  a29_6*dy6+a29_7*dy7+a29_8*dy8+a29_9*dy9+a29_10*dy10+a29_11*dy11 + &
         &  a29_12*dy12+a29_13*dy13+a29_14*dy14+a29_15*dy15+a29_16*dy16+a29_17*dy17 + &
         &  a29_18*dy18+a29_19*dy19+a29_20*dy20+a29_21*dy21+a29_22*dy22+a29_23*dy23 + &
         &  a29_24*dy24+a29_25*dy25+a29_26*dy26+a29_27*dy27+a29_28*dy28)
  ! use y29 to get dy29
  CALL  dev(t,y29,dy29,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y30=y0+h*(a30_0*dy0+a30_1*dy1+a30_2*dy2+a30_3*dy3+a30_4*dy4+a30_5*dy5 + &
         &  a30_6*dy6+a30_7*dy7+a30_8*dy8+a30_9*dy9+a30_10*dy10+a30_11*dy11 + &
         &  a30_12*dy12+a30_13*dy13+a30_14*dy14+a30_15*dy15+a30_16*dy16+a30_17*dy17 + &
         &  a30_18*dy18+a30_19*dy19+a30_20*dy20+a30_21*dy21+a30_22*dy22+a30_23*dy23 + &
         &  a30_24*dy24+a30_25*dy25+a30_26*dy26+a30_27*dy27+a30_28*dy28+a30_29*dy29)
  ! use y30 to get dy30
  CALL  dev(t,y30,dy30,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y31=y0+h*(a31_0*dy0+a31_1*dy1+a31_2*dy2+a31_3*dy3+a31_4*dy4+a31_5*dy5 + &
         &  a31_6*dy6+a31_7*dy7+a31_8*dy8+a31_9*dy9+a31_10*dy10+a31_11*dy11 + &
         &  a31_12*dy12+a31_13*dy13+a31_14*dy14+a31_15*dy15+a31_16*dy16+a31_17*dy17 + &
         &  a31_18*dy18+a31_19*dy19+a31_20*dy20+a31_21*dy21+a31_22*dy22+a31_23*dy23 + &
         &  a31_24*dy24+a31_25*dy25+a31_26*dy26+a31_27*dy27+a31_28*dy28+a31_29*dy29 + &
         &  a31_30*dy30)
  ! use y31 to get dy31
  CALL  dev(t,y31,dy31,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y32=y0+h*(a32_0*dy0+a32_1*dy1+a32_2*dy2+a32_3*dy3+a32_4*dy4+a32_5*dy5 + &
         &  a32_6*dy6+a32_7*dy7+a32_8*dy8+a32_9*dy9+a32_10*dy10+a32_11*dy11 + &
         &  a32_12*dy12+a32_13*dy13+a32_14*dy14+a32_15*dy15+a32_16*dy16+a32_17*dy17 + &
         &  a32_18*dy18+a32_19*dy19+a32_20*dy20+a32_21*dy21+a32_22*dy22+a32_23*dy23 + &
         &  a32_24*dy24+a32_25*dy25+a32_26*dy26+a32_27*dy27+a32_28*dy28+a32_29*dy29 + &
         &  a32_30*dy30+a32_31*dy31)
  ! use y32 to get dy32
  CALL  dev(t,y32,dy32,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y33=y0+h*(a33_0*dy0+a33_1*dy1+a33_2*dy2+a33_3*dy3+a33_4*dy4+a33_5*dy5 + &
         &  a33_6*dy6+a33_7*dy7+a33_8*dy8+a33_9*dy9+a33_10*dy10+a33_11*dy11 + &
         &  a33_12*dy12+a33_13*dy13+a33_14*dy14+a33_15*dy15+a33_16*dy16+a33_17*dy17 + &
         &  a33_18*dy18+a33_19*dy19+a33_20*dy20+a33_21*dy21+a33_22*dy22+a33_23*dy23 + &
         &  a33_24*dy24+a33_25*dy25+a33_26*dy26+a33_27*dy27+a33_28*dy28+a33_29*dy29 + &
         &  a33_30*dy30+a33_31*dy31+a33_32*dy32)
  ! use y33 to get dy33
  CALL  dev(t,y33,dy33,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  y34=y0+h*(a34_0*dy0+a34_1*dy1+a34_2*dy2+a34_3*dy3+a34_4*dy4+a34_5*dy5 + &
         &  a34_6*dy6+a34_7*dy7+a34_8*dy8+a34_9*dy9+a34_10*dy10+a34_11*dy11 + &
         &  a34_12*dy12+a34_13*dy13+a34_14*dy14+a34_15*dy15+a34_16*dy16+a34_17*dy17 + &
         &  a34_18*dy18+a34_19*dy19+a34_20*dy20+a34_21*dy21+a34_22*dy22+a34_23*dy23 + &
         &  a34_24*dy24+a34_25*dy25+a34_26*dy26+a34_27*dy27+a34_28*dy28+a34_29*dy29 + &
         &  a34_30*dy30+a34_31*dy31+a34_32*dy32+a34_33*dy33)
  ! use y34 to get dy34
  CALL  dev(t,y34,dy34,test)
  IF (test) THEN ! bad dy 
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) RETURN ! stop the program 
    hnew = MAX(MIN(h/2.D0,MaxStepSize),MinStepSize) ! reduce step 
    rerun = .True.
    test = .False.
    RETURN
  END IF

  yn=y0+h*(b0*dy0+b1*dy1+b2*dy2+b3*dy3+b4*dy4+b5*dy5+b6*dy6+b7*dy7 + &
        &  b8*dy8+b9*dy9+b10*dy10+b11*dy11+b12*dy12+b13*dy13+b14*dy14+b15*dy15 + &
        &  b16*dy16+b17*dy17+b18*dy18+b19*dy19+b20*dy20+b21*dy21+b22*dy22+b23*dy23 + &
        &  b24*dy24+b25*dy25+b26*dy26+b27*dy27+b28*dy28+b29*dy29+b30*dy30+b31*dy31 + &
        &  b32*dy32+b33*dy33+b34*dy34)
  yerr = (1.D0/1.D3)*h*ABS(dy1-dy33)
  ! Find the max value of y among this step
  DO i = 1, SIZE(y0)
    ymax(i) = MAX(MAX(ABS(y0(i)), ABS(yn(i))), h*ABS(dy0(i)))
  END DO
  tolh = rtol*ymax + atol(1:SIZE(y0)) ! atol might be a longer array

  ! using the error to estimate the next step
  err = MAXVAL(ABS(yerr/tolh))
  IF (err.GT.1.D0) THEN
    rerun = .True.
    hnew = MAX(0.8D0*err**(-1.D0/13.D0), 0.1D0)*h ! no less than factor of 0.1
    ! PRINT *, 'Decrease time step by', 0.8D0*err**(-1.D0/13.D0),MAX(0.8D0*err**(-1.D0/13.D0), 0.1D0)
  ELSE
    rerun = .False.
    hnew = MIN(5.D0, 0.8D0*err**(-1.D0/13.D0))*h ! no more than factor of 5
    ! PRINT *, 'Increase time step by', 0.8D0*err**(-1.D0/13.D0),MIN(5.D0,0.8D0*err**(-1.D0/13.D0))
  END IF

  ! adjust the step
  hnew = MAX(MIN(hnew,MaxStepSize),MinStepSize)
  IF (rerun) THEN
    IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) THEN ! h is already the min
      test = .True. ! stop the program
    ELSE
      hnew = MAX(MinStepSize,MIN(hnew, h*0.5D0)) ! if have not reduced, reduce to half
    END IF
    RETURN
  END IF

  ! check if any value have went crazy (Nan or Inf)
  DO i = 1, SIZE(y0)
    ! if any value is Nan or Inf, reRun this step
    IF (.NOT.IEEE_IS_NORMAL(yn(i))) THEN
      rerun = .True.
      IF (ABS(h-MinStepSize)/MinStepSize.LE.1D-13) THEN ! h is already the min
        test = .True. ! stop the program
      ELSE
        hnew = MAX(MinStepSize,MIN(hnew, h*0.5D0)) ! if have not reduced, reduce to half
      END IF
      RETURN
    END IF
  END DO

  RETURN
END SUBROUTINE

END MODULE
